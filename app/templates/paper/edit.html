{% extends "base.html" %}

{% block title %}Edit Paper - {{ paper.title }}{% endblock %}

{% block content %}
<div class="max-w-5xl mx-auto">
    <div class="mb-6">
        <h1 class="text-3xl font-bold text-gray-900">
            <i class="fas fa-edit mr-2 text-indigo-600"></i>
            Edit Paper
        </h1>
        <p class="text-gray-600 mt-2">Edit your research paper sections</p>
    </div>
    
    <form method="POST" class="space-y-6">
        <!-- Title -->
        <div class="bg-white shadow-lg rounded-lg p-6">
            <label for="title" class="block text-sm font-semibold text-gray-700 mb-2">
                Paper Title
            </label>
            <input type="text" id="title" name="title" required
                   value="{{ paper.title }}"
                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
        </div>
        
        <!-- Status -->
        <div class="bg-white shadow-lg rounded-lg p-6">
            <label for="status" class="block text-sm font-semibold text-gray-700 mb-2">
                Status
            </label>
            <select id="status" name="status"
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                <option value="Draft" {% if paper.status == 'Draft' %}selected{% endif %}>Draft</option>
                <option value="Review" {% if paper.status == 'Review' %}selected{% endif %}>In Review</option>
                <option value="Final" {% if paper.status == 'Final' %}selected{% endif %}>Final</option>
            </select>
        </div>
        
        <!-- Abstract -->
        <div class="bg-white shadow-lg rounded-lg p-6">
            <div class="flex items-center justify-between mb-2">
                <label for="abstract" class="block text-sm font-semibold text-gray-700">
                    Abstract
                </label>
                <button type="button" onclick="improveSection('abstract')"
                        class="text-sm bg-purple-600 text-white px-3 py-1 rounded hover:bg-purple-700">
                    <i class="fas fa-magic mr-1"></i> AI Improve
                </button>
            </div>
            <textarea id="abstract" name="abstract" rows="6"
                      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">{{ paper.abstract or '' }}</textarea>
        </div>
        
        <!-- Introduction -->
        <div class="bg-white shadow-lg rounded-lg p-6">
            <div class="flex items-center justify-between mb-2">
                <label for="introduction" class="block text-sm font-semibold text-gray-700">
                    Introduction
                </label>
                <button type="button" onclick="improveSection('introduction')"
                        class="text-sm bg-purple-600 text-white px-3 py-1 rounded hover:bg-purple-700">
                    <i class="fas fa-magic mr-1"></i> AI Improve
                </button>
            </div>
            <textarea id="introduction" name="introduction" rows="8"
                      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">{{ paper.introduction or '' }}</textarea>
        </div>
        
        <!-- Problem Statement -->
        <div class="bg-white shadow-lg rounded-lg p-6">
            <div class="flex items-center justify-between mb-2">
                <label for="problem_statement" class="block text-sm font-semibold text-gray-700">
                    Problem Statement
                </label>
                <button type="button" onclick="improveSection('problem_statement')"
                        class="text-sm bg-purple-600 text-white px-3 py-1 rounded hover:bg-purple-700">
                    <i class="fas fa-magic mr-1"></i> AI Improve
                </button>
            </div>
            <textarea id="problem_statement" name="problem_statement" rows="6"
                      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">{{ paper.problem_statement or '' }}</textarea>
        </div>
        
        <!-- Literature Review -->
        <div class="bg-white shadow-lg rounded-lg p-6">
            <div class="flex items-center justify-between mb-2">
                <label for="literature_review" class="block text-sm font-semibold text-gray-700">
                    Literature Review
                </label>
                <button type="button" onclick="improveSection('literature_review')"
                        class="text-sm bg-purple-600 text-white px-3 py-1 rounded hover:bg-purple-700">
                    <i class="fas fa-magic mr-1"></i> AI Improve
                </button>
            </div>
            <textarea id="literature_review" name="literature_review" rows="10"
                      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">{{ paper.literature_review or '' }}</textarea>
        </div>
        
        <!-- Methodology -->
        <div class="bg-white shadow-lg rounded-lg p-6">
            <div class="flex items-center justify-between mb-2">
                <label for="methodology" class="block text-sm font-semibold text-gray-700">
                    Methodology
                </label>
                <button type="button" onclick="improveSection('methodology')"
                        class="text-sm bg-purple-600 text-white px-3 py-1 rounded hover:bg-purple-700">
                    <i class="fas fa-magic mr-1"></i> AI Improve
                </button>
            </div>
            <textarea id="methodology" name="methodology" rows="8"
                      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">{{ paper.methodology or '' }}</textarea>
        </div>
        
        <!-- Results and Discussion -->
        <div class="bg-white shadow-lg rounded-lg p-6">
            <div class="flex items-center justify-between mb-2">
                <label for="results" class="block text-sm font-semibold text-gray-700">
                    Results and Discussion
                </label>
                <button type="button" onclick="improveSection('results')"
                        class="text-sm bg-purple-600 text-white px-3 py-1 rounded hover:bg-purple-700">
                    <i class="fas fa-magic mr-1"></i> AI Improve
                </button>
            </div>
            <textarea id="results" name="results" rows="10"
                      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">{{ paper.results or '' }}</textarea>
        </div>
        
        <!-- Conclusion -->
        <div class="bg-white shadow-lg rounded-lg p-6">
            <div class="flex items-center justify-between mb-2">
                <label for="conclusion" class="block text-sm font-semibold text-gray-700">
                    Conclusion
                </label>
                <button type="button" onclick="improveSection('conclusion')"
                        class="text-sm bg-purple-600 text-white px-3 py-1 rounded hover:bg-purple-700">
                    <i class="fas fa-magic mr-1"></i> AI Improve
                </button>
            </div>
            <textarea id="conclusion" name="conclusion" rows="6"
                      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">{{ paper.conclusion or '' }}</textarea>
        </div>
        
        <!-- Future Work -->
        <div class="bg-white shadow-lg rounded-lg p-6">
            <div class="flex items-center justify-between mb-2">
                <label for="future_work" class="block text-sm font-semibold text-gray-700">
                    Future Work
                </label>
                <button type="button" onclick="improveSection('future_work')"
                        class="text-sm bg-purple-600 text-white px-3 py-1 rounded hover:bg-purple-700">
                    <i class="fas fa-magic mr-1"></i> AI Improve
                </button>
            </div>
            <textarea id="future_work" name="future_work" rows="5"
                      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">{{ paper.future_work or '' }}</textarea>
        </div>
        
        <!-- References -->
        <div class="bg-white shadow-lg rounded-lg p-6">
            <label for="references" class="block text-sm font-semibold text-gray-700 mb-2">
                References
            </label>
            <textarea id="references" name="references" rows="5"
                      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                      placeholder="Add references here...">{{ paper.references or '' }}</textarea>
        </div>
        
        <!-- Actions -->
        <div class="flex items-center justify-between">
            <a href="{{ url_for('ai_paper.view', paper_id=paper.id) }}" class="text-gray-600 hover:text-gray-800">
                <i class="fas fa-arrow-left mr-1"></i> Cancel
            </a>
            <button type="submit"
                    class="bg-indigo-600 text-white px-8 py-3 rounded-lg font-semibold hover:bg-indigo-700 transition">
                <i class="fas fa-save mr-2"></i> Save Changes
            </button>
        </div>
    </form>
</div>

<script>
function improveSection(sectionName) {
    const textarea = document.getElementById(sectionName);
    const currentText = textarea.value;
    
    if (!currentText.trim()) {
        alert('Please add some text first before improving!');
        return;
    }
    
    // Show loading
    const btn = event.target;
    const originalText = btn.innerHTML;
    btn.innerHTML = '<i class="fas fa-spinner fa-spin mr-1"></i> Improving...';
    btn.disabled = true;
    
    // Call AI improvement endpoint
    fetch('{{ url_for("ai_paper.improve_section", paper_id=paper.id) }}', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            section: sectionName,
            text: currentText
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            textarea.value = data.improved_text;
            alert('Section improved! Review the changes.');
        } else {
            alert('Failed to improve: ' + data.message);
        }
    })
    .catch(error => {
        alert('Error: ' + error);
    })
    .finally(() => {
        btn.innerHTML = originalText;
        btn.disabled = false;
    });
}
</script>
{% endblock %}
