{% extends "base.html" %}

{% block title %}Dashboard - ResearchHub AI{% endblock %}

{% block content %}
<div class="animate-fade-in">
    <!-- Header -->
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-900">
            <i class="fas fa-dashboard mr-2 text-indigo-600"></i>
            Dashboard
        </h1>
        <p class="text-gray-600 mt-1">Welcome back, {{ current_user.name }}!</p>
    </div>
    
    <!-- Quick Stats -->
    <div class="grid md:grid-cols-4 gap-6 mb-8">
        <div class="bg-white rounded-lg shadow p-6">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-gray-600">Active Projects</p>
                    <p class="text-2xl font-bold text-gray-900">{{ active_projects|length }}</p>
                </div>
                <div class="bg-indigo-100 rounded-full p-3">
                    <i class="fas fa-folder text-indigo-600 text-xl"></i>
                </div>
            </div>
        </div>
        
        <div class="bg-white rounded-lg shadow p-6">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-gray-600">Research Papers</p>
                    <p class="text-2xl font-bold text-gray-900">{{ recent_papers|length }}</p>
                </div>
                <div class="bg-green-100 rounded-full p-3">
                    <i class="fas fa-file-alt text-green-600 text-xl"></i>
                </div>
            </div>
        </div>
        
        <div class="bg-white rounded-lg shadow p-6">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-gray-600">Unread Messages</p>
                    <p class="text-2xl font-bold text-gray-900">{{ unread_messages }}</p>
                </div>
                <div class="bg-blue-100 rounded-full p-3">
                    <i class="fas fa-envelope text-blue-600 text-xl"></i>
                </div>
            </div>
        </div>
        
        <div class="bg-white rounded-lg shadow p-6">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-gray-600">AI Alerts</p>
                    <p class="text-2xl font-bold text-gray-900">{{ papers_needing_review }}</p>
                </div>
                <div class="bg-yellow-100 rounded-full p-3">
                    <i class="fas fa-robot text-yellow-600 text-xl"></i>
                </div>
            </div>
        </div>
    </div>
    
    <div class="grid lg:grid-cols-2 gap-8">
        <!-- Active Projects -->
        <div class="bg-white rounded-lg shadow">
            <div class="p-6 border-b">
                <h2 class="text-xl font-bold text-gray-900 flex items-center justify-between">
                    <span><i class="fas fa-folder mr-2 text-indigo-600"></i> Active Projects</span>
                    <a href="{{ url_for('project.create') }}" class="text-sm bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700">
                        <i class="fas fa-plus mr-1"></i> New
                    </a>
                </h2>
            </div>
            <div class="p-6">
                {% if active_projects %}
                <div class="space-y-4">
                    {% for project in active_projects %}
                    <div class="border rounded-lg p-4 hover:shadow-md transition">
                        <h3 class="font-semibold text-gray-900">
                            <a href="{{ url_for('project.view', project_id=project.id) }}" class="hover:text-indigo-600">
                                {{ project.title }}
                            </a>
                        </h3>
                        <p class="text-sm text-gray-600 mt-1">{{ project.abstract[:100] }}...</p>
                        <div class="flex items-center mt-2 text-xs text-gray-500">
                            <span class="bg-green-100 text-green-800 px-2 py-1 rounded">{{ project.status }}</span>
                            <span class="ml-3"><i class="fas fa-users mr-1"></i> {{ project.members.count() }} members</span>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p class="text-gray-500 text-center py-8">
                    <i class="fas fa-folder-open text-4xl mb-2"></i><br>
                    No active projects yet
                </p>
                {% endif %}
            </div>
        </div>
        
        <!-- Suggested Researchers -->
        <div class="bg-white rounded-lg shadow">
            <div class="p-6 border-b">
                <h2 class="text-xl font-bold text-gray-900">
                    <i class="fas fa-users mr-2 text-indigo-600"></i> Suggested Collaborators
                </h2>
            </div>
            <div class="p-6">
                {% if suggested_researchers %}
                <div class="space-y-4">
                    {% for match in suggested_researchers %}
                    <div class="border rounded-lg p-4 hover:shadow-md transition">
                        <div class="flex items-start justify-between">
                            <div class="flex-1">
                                <h3 class="font-semibold text-gray-900">
                                    <a href="{{ url_for('profile.view', user_id=match.user.id) }}" class="hover:text-indigo-600">
                                        {{ match.user.name }}
                                    </a>
                                </h3>
                                <p class="text-sm text-gray-600">{{ match.user.institution }}</p>
                                <div class="flex flex-wrap gap-1 mt-2">
                                    {% for tag in match.common_tags %}
                                    <span class="bg-indigo-100 text-indigo-800 text-xs px-2 py-1 rounded">{{ tag }}</span>
                                    {% endfor %}
                                </div>
                            </div>
                            <span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded font-semibold">
                                {{ match.score }} match{{ 'es' if match.score != 1 }}
                            </span>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                <div class="mt-4 text-center">
                    <a href="{{ url_for('research.discover') }}" class="text-indigo-600 hover:text-indigo-800 text-sm font-medium">
                        View All <i class="fas fa-arrow-right ml-1"></i>
                    </a>
                </div>
                {% else %}
                <p class="text-gray-500 text-center py-8">
                    <i class="fas fa-user-friends text-4xl mb-2"></i><br>
                    Complete your profile to find matches
                </p>
                {% endif %}
            </div>
        </div>
    </div>
    
    <!-- Recent Papers -->
    <div class="mt-8 bg-white rounded-lg shadow">
        <div class="p-6 border-b">
            <h2 class="text-xl font-bold text-gray-900 flex items-center justify-between">
                <span><i class="fas fa-file-alt mr-2 text-indigo-600"></i> Recent Papers</span>
                <a href="{{ url_for('ai_paper.create') }}" class="text-sm bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
                    <i class="fas fa-robot mr-1"></i> Generate with AI
                </a>
            </h2>
        </div>
        <div class="p-6">
            {% if recent_papers %}
            <div class="space-y-4">
                {% for paper in recent_papers %}
                <div class="border rounded-lg p-4 hover:shadow-md transition">
                    <div class="flex items-start justify-between">
                        <div class="flex-1">
                            <h3 class="font-semibold text-gray-900">
                                <a href="{{ url_for('ai_paper.view', paper_id=paper.id) }}" class="hover:text-indigo-600">
                                    {{ paper.title }}
                                </a>
                            </h3>
                            <p class="text-sm text-gray-600 mt-1">{{ paper.domain }}</p>
                            <div class="flex items-center mt-2 text-xs text-gray-500">
                                <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded">{{ paper.status }}</span>
                                {% if paper.ai_generated %}
                                <span class="ml-2 bg-purple-100 text-purple-800 px-2 py-1 rounded">
                                    <i class="fas fa-robot mr-1"></i> AI Generated
                                </span>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <p class="text-gray-500 text-center py-8">
                <i class="fas fa-file-alt text-4xl mb-2"></i><br>
                No papers yet. Create your first AI-powered paper!
            </p>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
